#!/bin/bash

DATA_DIR="/etc/ipset-sync/data"
LOG_DIR="/etc/ipset-sync/logs"
LOG_FILE="$LOG_DIR/import.log"

mkdir -p "$LOG_DIR"

log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

if [ ! -d "$DATA_DIR" ]; then
    log "‚ùå Data directory not found: $DATA_DIR"
    exit 1
fi

for file in "$DATA_DIR"/*.txt; do
    [ -e "$file" ] || continue

    listname=$(basename "$file" .txt)

    log "üîÅ Importing $listname from $file..."

    # –°—Ç–≤–æ—Ä—é—î–º–æ —Å–ø–∏—Å–æ–∫
    ipset create "$listname" hash:net family inet hashsize 1024 maxelem 65536

    # –Ü–º–ø–æ—Ä—Ç
    if ipset restore < "$file" 2>>"$LOG_FILE"; then
        log "‚úÖ Imported: $listname"
    else
        log "‚ùå Error importing: $listname"
    fi

done
